<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Lignes de CrÃªtes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    {% load static %}

    <!-- Leaflet CSS et JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="{% static 'hello/leaflet.polylineDecorator.js' %}"></script>

    <!-- Leaflet Heightgraph CSS et JS -->
    <link rel="stylesheet" href="{% static 'hello/L.Control.Heightgraph.min.css' %}" />
    <script src="{% static 'hello/L.Control.Heightgraph.min.js' %}"></script>

    <!-- Leaflet elevation -->
    <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.css" />
    <script src="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.js"></script>

    <!-- Styles principaux -->
    <link rel="stylesheet" type="text/css" href="{% static 'hello/site.css' %}" />
    <link rel="icon" href="{% static 'hello/favicon.png' %}" type="image/x-icon">
    <!-- Microsoft Clarity-->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "ul00b7mgbw");
    </script>

</head>

<body>
<header>
    <div class="logo-container">
    <img src="static/hello/favicon.png" alt="Logo Lignes de crÃªtes" />
    <h2>Lignes de crÃªtes</h2>
    </div>
    <div class="nav-buttons">
        <button id="infoBtn">En savoir plus</button>
        <button onclick="window.open('https://github.com/sponsors/aangelot/', '_blank')">Soutenir</button>
        <button class="highlight" onclick="window.open('https://framaforms.org/evaluation-lignes-de-cretes-1761382300', '_blank')">Donner son avis</button>
    </div>
</header>

<!-- Modale -->
<div id="infoModal" class="modal">
    <div class="modal-content">
    <h2>Ã€ propos de Lignes de crÃªtes</h2>
    <p>ğŸŒ„ Lignes de crÃªtes, câ€™est une application libre qui invite Ã  (re)dÃ©couvrir les montagnes autrement â€” en combinant randonnÃ©e et transports en commun. Elle calcule pour vous des itinÃ©raires de trek optimisÃ©s selon vos envies : durÃ©e, confort, points dâ€™intÃ©rÃªtâ€¦ et mÃªme une touche dâ€™alÃ©atoire pour lâ€™aventure. </p>
    <p>ğŸ¥¾ğŸš†Chaque parcours est une invitation Ã  ralentir, explorer et se reconnecter au vivant, en privilÃ©giant des modes de dÃ©placement respectueux de la nature et de ses Ã©quilibres. ğŸ’š</p>
    <p> Cette application utilise les donnÃ©es d'<a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>. Cartographie : Â© OpenStreetMap contributors. DonnÃ©es sous licence ODbL.</p>
    <button class="close-btn" id="closeModal">Fermer</button>
    </div>
</div>
<!-- Modale d'avertissement avant tÃ©lÃ©chargement GPX -->
<div id="gpxWarningModal" class="modal">
  <div class="modal-content">
    <h2>Avertissement avant tÃ©lÃ©chargement</h2>
    <p>
      Les traces GPX fournies par cette application sont des aides Ã  la navigation.
      Elles ne remplacent pas une carte papier (par exemple IGN), une bonne prÃ©paration
      et l'Ã©valuation de vos capacitÃ©s. Soyez prudentÂ·e en montagne, vÃ©rifiez la mÃ©tÃ©o
      et prÃ©parez-vous en consÃ©quence. L'algorithme peut proposer des itinÃ©raires qui
      ne conviennent pas Ã  tout le monde.
    </p>
    <div style="display:flex; gap:0.5em; justify-content:flex-end; margin-top:1em;">
      <button class="close-btn" id="gpx-cancel-btn">Annuler</button>
      <button class="close-btn highlight" id="gpx-confirm-btn">J'ai compris, tÃ©lÃ©charger le fichier GPX</button>
    </div>
  </div>
</div>
 <!-- MAP -->
  <div id="map"></div>

<div id="modals-container">
  <!-- MODALE FORMULAIRE -->
  <div id="form-modal" class="floating-modal expanded">
    <div class="modal-header">
      <h3>ğŸ“ PrÃ©parer mon trek</h3>
      <button class="toggle-btn" id="toggle-form">â–²</button>
    </div>
      <div class="modal-body">
      <form id="trek-form" method="get" class="text-form">
        <p>
          Je souhaite partir dans  
          <select id="massif" name="massif">
            <option value="Chartreuse" selected>la Chartreuse</option>
            <option value="Massif des Bauges">les Bauges</option>
            <option value="Haut Jura">le Haut Jura</option>
            <option value="Lyonnais">les alentours de Lyon</option>
            <option value="Vercors">le Vercors</option>
          </select>
          en partant de :
          <input
            type="text"
            id="address"
            name="address"
            placeholder="Saisir une adresseâ€¦"
            autocomplete="off"
            required
          >
          <div id="address-suggestions" class="suggestions"></div>
          <script src="{% static 'hello/ban-autocomplete.js' %}" defer></script>
        </p>
        
        <p>
          Je pars le 
          <input type="datetime-local" id="departure_datetime" name="departure_datetime" required>
          pour Ãªtre de retour le 
          <input type="datetime-local" id="return_datetime" name="return_datetime" required>
        </p>
        <div id="date-error" style="color: #ff6b6b; margin-top: 0.5em;"></div>

        <p>
          Mon niveau de marche est :
          <select id="level" name="level">
            <option value="debutant">&lt; 10 km / jour (DÃ©butant)</option>
            <option value="intermediaire" selected>10â€“20 km / jour (IntermÃ©diaire)</option>
            <option value="avance">20â€“30 km / jour (AvancÃ©)</option>
            <option value="expert">&gt; 30 km /jour (Expert)</option>
          </select>
        </p>

        <p>
          Je souhaite une part dâ€™alÃ©atoire dans le tracÃ© :
          <select id="randomness" name="randomness">
            <option value="0.1">ğŸ§­ ItinÃ©raire classique (les bases)</option>
            <option value="0.3" selected>âš–ï¸ Ã‰quilibre entre logique et surprise</option>
            <option value="0.6">ğŸŒ¿ Exploration (hors sentiers connus)</option>
            <option value="1">ğŸ”¥ Aventure totale (imprÃ©visible)</option>
          </select>
        </p>

        <p>
          PrioritÃ© pour le trajet en transports :
          <select id="transit_priority" name="transit_priority">
            <option value="fast">â±ï¸ Le moins de temps dans les transports</option>
            <option value="balanced" selected>âš–ï¸ Ã‰quilibrÃ©</option>
            <option value="deep_nature">ğŸŒ² Aller au coeur du massif</option>
          </select>
        </p>

        <p style="text-align: center; margin-top: 1em;">
          <button type="submit" id="submit-btn">Trouver mon trek</button>
        </p>
      </form>
    </div>
  </div>

  <!-- Modale RÃ©sumÃ© -->
  <div id="modal-summary" class="floating-modal collapsed"></div>
  
  <!-- Modale Aller -->
  <div id="modal-go" class="floating-modal collapsed"></div>

  <!-- Modale Retour -->
  <div id="modal-back" class="floating-modal collapsed"></div>

  
</div>


{% if path %}
<div id="path-data" data-coords='{{ path|escapejs }}'></div>
{% endif %}

<script src="{% static 'hello/index.js' %}"></script>
</body>
</html>
