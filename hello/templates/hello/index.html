<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lignes de Crêtes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'hello/site.css' %}"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</head>
<body>
<div class="container">
    <div class="sidebar">
        <h2>Hike Planner</h2>
        <form id="trek-form" method="get">
            <label for="city">Ville de départ :</label>
            <select id="city">
                <option value="lyon" selected>Lyon</option>
                <!-- D'autres villes à ajouter plus tard -->
            </select>

            <label for="massif">Massif :</label>
            <select id="massif">
                <option value="chartreuse" selected>Chartreuse</option>
                <!-- D'autres massifs à ajouter plus tard -->
            </select>

            <label for="level">Niveau :</label>
            <select id="level">
                <option value="debutant">&lt; 10 km (Débutant)</option>
                <option value="intermediaire">10–20 km (Intermédiaire)</option>
                <option value="avance">20–30 km (Avancé)</option>
                <option value="expert">&gt; 30 km (Expert)</option>
            </select>

            <button type="submit">Trouver mon trek</button>
        </form>

    </div>
    <div class="map-container">
        <div id="map"></div>
    </div>
</div>

{% if path %}
    <div id="path-data" data-coords='{{ path|escapejs }}'></div>
{% endif %}

<script>
    const map = L.map('map').setView([45.36, 5.79], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let currentLayer = null;

    document.getElementById('trek-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const city = document.getElementById('city').value;
        const massif = document.getElementById('massif').value;
        const level = document.getElementById('level').value;

        // Construction de l'URL GET avec paramètres
        const url = `/get_route/?city=${encodeURIComponent(city)}&massif=${encodeURIComponent(massif)}&level=${encodeURIComponent(level)}`;

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur lors de la récupération du tracé');
                }
                return response.json();
            })
            .then(data => {
                if (currentLayer) {
                    map.removeLayer(currentLayer);
                }

                currentLayer = L.geoJSON(data, {
                    style: { color: 'blue' }
                }).addTo(map);

                map.fitBounds(currentLayer.getBounds());
            })
            .catch(error => {
                alert(error.message);
                console.error(error);
            });
    });
</script>



</body>
</html>